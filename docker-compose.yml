services:
  # BOINC клиент 1
  boinc-client-1:
    build: ./client
    container_name: boinc-client-1
    volumes:
      - boinc_client_data_1:/var/lib/boinc
    environment:
      - BOINC_PROJECT_URL=http://boinc-server-docker-apache-1/boincserver
      - BOINC_CLIENT_NAME=client-1
      - CLIENT_ID=0
    networks:
      - boinc-network
    restart: unless-stopped
    command: >
      bash -c "
        chmod +x /startup.sh &&
        /startup.sh
      "

  # BOINC клиент 2
  boinc-client-2:
    build: ./client
    container_name: boinc-client-2
    volumes:
      - boinc_client_data_2:/var/lib/boinc
    environment:
      - BOINC_PROJECT_URL=http://boinc-server-docker-apache-1/boincserver
      - BOINC_CLIENT_NAME=client-2
      - CLIENT_ID=1
    networks:
      - boinc-network
    restart: unless-stopped
    command: >
      bash -c "
        chmod +x /startup.sh &&
        /startup.sh
      "

  # Монитор результатов
  results-monitor:
    image: python:3.9-slim
    container_name: results-monitor
    volumes:
      - "./scripts:/scripts"
      - "boinc-server-docker_results:/results"
    environment:
      - MONITOR_INTERVAL=10
    networks:
      - boinc-network
    command: python /scripts/monitor_results.py
    restart: unless-stopped

volumes:
  boinc_client_data_1:
  boinc_client_data_2:
  boinc-server-docker_results:
    external: true

networks:
  boinc-network:
    name: boinc-server-docker_default
    external: true